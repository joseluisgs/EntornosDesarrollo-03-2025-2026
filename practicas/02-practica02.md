## Práctica 2: Ramificación Local, Integración y Manipulación del Historial

- [Práctica 2: Ramificación Local, Integración y Manipulación del Historial](#práctica-2-ramificación-local-integración-y-manipulación-del-historial)
  - [Conceptos Clave a Introducir y Reforzar:](#conceptos-clave-a-introducir-y-reforzar)
  - [Fase 1: Creación de Ramas y Desarrollo Divergente](#fase-1-creación-de-ramas-y-desarrollo-divergente)
  - [Fase 2: Integración (Merge) y Resolución de Conflictos](#fase-2-integración-merge-y-resolución-de-conflictos)
  - [Fase 3: Reorganización (Rebase) para un Historial Lineal](#fase-3-reorganización-rebase-para-un-historial-lineal)
  - [Fase 4: Seleccionar Commits Específicos (Cherry Pick)](#fase-4-seleccionar-commits-específicos-cherry-pick)
  - [Fase 5: Equivocaciones y Solución (Commit a la Rama Incorrecta)](#fase-5-equivocaciones-y-solución-commit-a-la-rama-incorrecta)
  - [Reflexión Final: Importancia de las Ramas](#reflexión-final-importancia-de-las-ramas)


### Conceptos Clave a Introducir y Reforzar:

1.  **Ramificación (*Branching*):** Permite trabajar en distintas versiones de un proyecto a la vez sin afectar la línea principal. Las ramas representan líneas de desarrollo independientes.
2.  **Integración (*Merge*):** Une dos conjuntos de cambios sobre un fichero o conjunto de ficheros en una revisión unificada.
3.  **Reorganización (*Rebase*):** Permite reescribir la historia, moviendo commits de una rama a la punta de otra para conseguir un historial más lineal.
4.  **Cherry Pick:** Aplica una confirmación específica (commit) de una rama a otra, sin fusionar la rama completa.

### Fase 1: Creación de Ramas y Desarrollo Divergente

| **Paso** | **Descripción y Comandos**                                                                                                                                                                   | **Concepto de Git**                                                                                                                                                                          |
| :------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **1.1**  | **Inicializa el repositorio** `practica02` y **configura** tu identidad (si no lo hiciste en la práctica anterior).                                                                          |                                                                                                                                                                                              |
| **1.2**  | **Crea el archivo inicial** `base.txt` con la línea "Estructura principal del proyecto." y confírmalo: `git add .` y `git commit -m "feat: Commit base."`                                    | Punto de partida común.                                                                                                                                                                      |
| **1.3**  | **Crea y cambia a una nueva rama** para una característica: `git checkout -b feature/login`                                                                                                  | La ramificación es una de las características más potentes de Git y permite desarrollar nuevas funcionalidades sin afectar la rama principal.                                                |
| **1.4**  | **En la rama `feature/login`:** Crea el archivo `login.html` con un título simple (ej: "Página de inicio de sesión"). Confirma los cambios: `git commit -m "feat: Añadida página de login."` | El nuevo archivo solo existe en esta rama.                                                                                                                                                   |
| **1.5**  | **Vuelve a la rama principal** (`master` o `main`): `git checkout master`                                                                                                                    | Los archivos de tu directorio de trabajo cambian para reflejar el estado de la rama a la que saltas. **Verifica:** El archivo `login.html` **debe desaparecer** de tu directorio de trabajo. |
| **1.6**  | **En la rama `master`:** Crea el archivo `index.html` con un título (ej: "Página principal"). Confirma los cambios: `git commit -m "feat: Añadida página de inicio."`                        | La historia de ambas ramas ha divergido, ya que tienen commits diferentes después del punto común.                                                                                           |
| **1.7**  | **Visualiza el historial** incluyendo todas las ramas: `git log --oneline --graph --all`                                                                                                     | Observa los dos caminos de desarrollo paralelos.                                                                                                                                             |

### Fase 2: Integración (Merge) y Resolución de Conflictos

| **Paso** | **Descripción y Comandos**                                                                                                                                                                                          | **Concepto de Git**                                                                                                                                          |
| :------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | :----------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **2.1**  | **Vuelve a la rama** `feature/login`: `git checkout feature/login`                                                                                                                                                  |                                                                                                                                                              |
| **2.2**  | **Modifica** `base.txt` para añadir una línea de contenido (ej: "Línea 1: Contenido de la rama de login."). Confirma: `git commit -m "chore: Actualización en base.txt (login)."`.                                  | Esto asegurará un conflicto posterior.                                                                                                                       |
| **2.3**  | **Vuelve a la rama `master`:** `git checkout master`                                                                                                                                                                |                                                                                                                                                              |
| **2.4**  | **Modifica** `base.txt` en la **misma línea** donde modificaste en la otra rama, o muy cerca (ej: "Línea 2: Contenido de la rama master."). Confirma: `git commit -m "chore: Actualización en base.txt (master)."`. | **Divergencia con potencial conflicto.**                                                                                                                     |
| **2.5**  | **Intenta fusionar** `feature/login` en `master`: `git merge feature/login`                                                                                                                                         | La fusión une dos conjuntos de cambios. Si Git no puede manejar adecuadamente los cambios realizados en la misma parte del archivo, se produce un conflicto. |
| **2.6**  | **Resuelve el Conflicto:** Git te indicará que `base.txt` está en conflicto (unmerged). Abre `base.txt` y verás los **marcadores de conflicto** (`<<<<<<<`, `=======`, `>>>>>>>`).                                  | El usuario debe intervenir para atender el conflicto.                                                                                                        |
| **2.7**  | **Edita manualmente** `base.txt`, decidiendo qué líneas conservar. Elimina los marcadores.                                                                                                                          |                                                                                                                                                              |
| **2.8**  | **Marca el conflicto como resuelto:** `git add base.txt`                                                                                                                                                            | .                                                                                                                                                            |
| **2.9**  | **Finaliza la fusión:** `git commit` (acepta el mensaje de fusión por defecto o personalízalo).                                                                                                                     | Esto crea un *commit de fusión* (Merge commit).                                                                                                              |
| **2.10** | **Visualiza el historial** (`git log --oneline --graph`).                                                                                                                                                           | Observa cómo el historial se entrelaza, mostrando una estructura no lineal con el commit de fusión.                                                          |
| **2.11** | **Elimina la rama** `feature/login` (ya fusionada): `git branch -d feature/login`                                                                                                                                   | Las ramas fusionadas se pueden eliminar con `git branch -d`.                                                                                                 |

### Fase 3: Reorganización (Rebase) para un Historial Lineal

| **Paso** | **Descripción y Comandos**                                                                                                                    | **Concepto de Git**                                                                                                                                                  |
| :------- | :-------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **3.1**  | **Crea y cambia a una nueva rama** de característica: `git checkout -b feature/style`                                                         |                                                                                                                                                                      |
| **3.2**  | **En `feature/style`:** Crea `style.txt` (simulando un CSS) con contenido "color: blue;". Confirma: `git commit -m "feat: Estilo base azul."` |                                                                                                                                                                      |
| **3.3**  | **Vuelve a la rama `master`:** `git checkout master`                                                                                          |                                                                                                                                                                      |
| **3.4**  | **En `master`:** Modifica `index.html` (ej: añade una línea). Confirma: `git commit -m "docs: Pequeña mejora en index."`                      | La rama `master` ha avanzado, creando una divergencia.                                                                                                               |
| **3.5**  | **Vuelve a `feature/style`:** `git checkout feature/style`                                                                                    |                                                                                                                                                                      |
| **3.6**  | **Reorganiza `feature/style` sobre `master`:** `git rebase master`                                                                            | `rebase` reescribe la historia moviendo los commits de `feature/style` para que parezca que parten del último commit de `master`.                                    |
| **3.7**  | **Visualiza el historial** (`git log --oneline --graph`).                                                                                     | La rama `feature/style` debería parecer que comienza *después* del commit "Pequeña mejora en index." de `master`.                                                    |
| **3.8**  | **Vuelve a `master` y fusiona:** `git checkout master` y `git merge feature/style`                                                            | Gracias al *rebase* previo, la fusión debería ser un "avance rápido" (*fast-forward merge*), manteniendo la historia lineal sin crear un commit de fusión explícito. |
| **3.9**  | **Elimina la rama** `feature/style`: `git branch -d feature/style`                                                                            |                                                                                                                                                                      |

### Fase 4: Seleccionar Commits Específicos (Cherry Pick)

| **Paso** | **Descripción y Comandos**                                                                                                                                         | **Concepto de Git**                                                                                                                                  |
| :------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------- |
| **4.1**  | **Crea y cambia a una nueva rama** de utilidad: `git checkout -b feature/util`                                                                                     |                                                                                                                                                      |
| **4.2**  | **En `feature/util` (Commit 1):** Crea `utility.txt` con la línea "Función A: Importante". Confirma: `git commit -m "feat: Añadida función A."`                    |                                                                                                                                                      |
| **4.3**  | **En `feature/util` (Commit 2):** Modifica `utility.txt` añadiendo "Función B: Experimental". Confirma: `git commit -m "feat: Añadida función B (experimental)."`. |                                                                                                                                                      |
| **4.4**  | **Vuelve a `master`:** `git checkout master`                                                                                                                       |                                                                                                                                                      |
| **4.5**  | **Identifica el ID del Commit 1** (el que introdujo la Función A) usando `git log --oneline feature/util` y anota el código hash (ej: `a1b2c3d`).                  | Necesitas la referencia del commit que quieres seleccionar.                                                                                          |
| **4.6**  | **Aplica solo el Commit 1 a `master`:** `git cherry-pick a1b2c3d`                                                                                                  | `cherry-pick` toma una instantánea específica de otra rama y la aplica al HEAD actual. Esto crea un nuevo commit en `master` con el mismo contenido. |
| **4.7**  | **Visualiza el historial** (`git log --oneline --graph`).                                                                                                          | Observa que el commit de "Función A" ahora existe en `master`, pero el commit de "Función B (experimental)" solo existe en `feature/util`.           |
| **4.8**  | **Elimina la rama** `feature/util` (si ya no la necesitas): `git branch -D feature/util`                                                                           | Usamos `-D` (mayúscula) para forzar la eliminación, ya que el Commit 2 aún no ha sido fusionado.                                                     |

### Fase 5: Equivocaciones y Solución (Commit a la Rama Incorrecta)

| **Paso** | **Descripción y Comandos**                                                                                                                                                                             | **Concepto de Git**                                                                                                                                               |
| :------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **5.1**  | **Crea una nueva rama** `feature/bug-fix` y cambia a ella: `git checkout -b feature/bug-fix`                                                                                                           |                                                                                                                                                                   |
| **5.2**  | **Vuelve por error a `master`:** `git checkout master`                                                                                                                                                 |                                                                                                                                                                   |
| **5.3**  | **Equivocación:** Modifica `index.html` (ej: "Error corregido aquí.") y confírmalo en `master`: `git commit -m "bug: Corregido error crítico (¡Error de rama!)"`                                       | **¡Acabas de comitear a la rama principal por error!**.                                                                                                           |
| **5.4**  | **Solución (Mover el commit):**                                                                                                                                                                        | La solución es usar `cherry-pick` para mover el cambio a la rama correcta y luego `reset` en la incorrecta.                                                       |
| **5.5**  | **Paso 1: Mueve el commit a la rama correcta.** Identifica el ID del último commit en `master` (`git log -1 --oneline`). Luego: `git checkout feature/bug-fix` y `git cherry-pick <commit_id_del_bug>` | Esto aplica el cambio a la rama correcta (`feature/bug-fix`).                                                                                                     |
| **5.6**  | **Paso 2: Limpia la rama principal.** Vuelve a `master`: `git checkout master`                                                                                                                         |                                                                                                                                                                   |
| **5.7**  | **Deshaz el último commit en `master` y bórralo permanentemente:** `git reset --hard HEAD~1`                                                                                                           | **`git reset --hard`** elimina el commit y limpia el directorio de trabajo, restaurando la historia de `master` a su estado previo. ¡Ten cuidado, es destructivo! |
| **5.8**  | **Verifica el historial** (`git log --oneline --graph`).                                                                                                                                               | El commit de corrección de error ahora solo debe existir en la rama `feature/bug-fix`, y `master` debe estar limpio.                                              |
| **5.9**  | **Continúa el desarrollo:** Si el arreglo en `feature/bug-fix` es final, vuelve a `master` e integra los cambios: `git checkout master` y `git merge feature/bug-fix`.                                 | La rama principal ya está corregida y la historia es coherente.                                                                                                   |

### Reflexión Final: Importancia de las Ramas

El uso de ramas permite a los desarrolladores:

*   **Aislar el Trabajo:** Puedes tener ficheros como `login.html` o `style.txt` en una rama (`feature-a`) y no en la otra (`master`), garantizando que la rama principal (master) se mantenga estable.
*   **Experimentación Segura:** Permite la creación de "ramas de prueba" que contengan código para evaluación. Si las modificaciones se aprueban, se realiza una fusión (`merge`) con la rama principal.
*   **Historial Controlado:** Técnicas como `rebase` ayudan a mantener un historial de proyecto limpio y lineal, mientras que `merge` documenta explícitamente la integración de dos líneas divergentes con un commit de fusión.
*   **Transferencia Selectiva:** `cherry-pick` permite trasladar *un* cambio específico (commit) sin tener que integrar toda la línea de desarrollo, útil para aplicar correcciones rápidas o funcionalidades puntuales.